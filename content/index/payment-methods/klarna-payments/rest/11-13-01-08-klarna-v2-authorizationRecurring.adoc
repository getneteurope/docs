:txTypeName: authorizationRecurring

[#KlarnaV2_TransactionTypes_authorizationRecurring]
==== Recurring _authorization_

Klarna Payments support <<GeneralPlatformFeatures_Transactions_Recurring, recurring>> transactions. +

To initiate recurring payments, you need to provide appropriate values for <<KlarnaV2_TransactionTypes_authorizationRecurring_Fields_periodicType, ``periodic-type``>> and <<KlarnaV2_TransactionTypes_authorizationRecurring_Fields_sequenceType, ``sequence-type``>> in your ``authorization`` request. From these values, {payment-gateway} generates a consumer token that can be used for recurring payments.

You can capture recurring authorizations automatically with <<KlarnaV2_TransactionTypes_authorization_autoCapture, **auto-capture**.>>

[#KlarnaV2_TransactionTypes_authorizationRecurring_Fields]
===== Recurring _authorization_ Fields

Fields can be **M**andatory or **O**ptional.

[%autowidth,stripes=none]
[cols="m,,,,"]
|===
|Field |<<APIRef_FieldDefs_Cardinality, M/O>> |Data Type |Size |Description

|merchant-account-id 
|M 
|String 
|36 
|A unique identifier assigned
to every merchant account (by {payment-provider-name}).

|request-id 
|M
|String 
|150 
a|A unique identifier assigned by the merchant
to each request. Used when searching for or referencing it later.

As the request ID must be unique, ``{{$guid}}`` serves as a placeholder; Postman
uses it to generate a random ``request-id`` for testing.

Allowed characters:  ``[a-z0-9-\_]``.

|transaction-type 
|M  
|String
|30 
|The requested transaction type. Set this field to `authorization`.

|requested-amount  
|M
|Numeric
|18.3
|Total order amount to be reserved. The number of decimal places depends on the currency. +
The requested amount must be equal to the total amount of all order items.

Use ``.`` (decimal point) as separator.

|[[KlarnaV2_TransactionTypes_{txTypeName}_Fields_requestedAmount_currency]]requested-amount@currency 
|M  
|String
|3 
a|The <<KlarnaV2_CountriesCurrencies, currency>> of the requested/contested
transaction amount. +
Format: 3-character abbreviation according to ISO 4217.

|parent-transaction-id
|M/O 
|String	
|36	
a|Enter the ``transaction-id`` of a preceding _authorization_. That can be either the first (``initial``) or any other previous (``recurring``) authorization. +
**Mandatory** for recurring authorizations with <<KlarnaV2_TransactionTypes_authorizationRecurring_Fields_sequenceType, ``sequence-type`` ``recurring``>> or <<KlarnaV2_TransactionTypes_authorizationRecurring_Fields_sequenceType, ``final``.>>

|auto-capture
|O
|Boolean
|
a|Set this field to ``true`` to enable <<KlarnaV2_TransactionTypes_authorization_autoCapture, auto-capture.>> +
If this ``authorization`` is successful, it will be <<KlarnaV2_TransactionTypes_authorization_autoCapture, captured automatically.>> +
For <<KlarnaV2_TransactionTypes_{txTypeName}_Fields_orderItem_type_digital, digital goods/services>> only.

|order-number	
|O 
|String
|255 
|Order number as provided by merchant. +
If you send it, it shows as "order number" on _Klarna_'s payment confirmation page.

|locale	
|M 
|String
|5 
|A 5-letter code that indicates what <<KlarnaV2_Locales, language>> the payment page is rendered in (RFC 1766).

|transaction-id 
|Response only
|String
|36
|A unique identifier assigned for every transaction. Generated by {payment-provider-name}. Used when searching for or referencing it later.

|transaction-state 
|Response only
|String
|12
a|Transaction status. +
Possible values: 

  - ``success``
  - ``failed``

//-

|completion-time-stamp
|Response only
|DateTime
|
|The timestamp documents the time and date when the transaction was completed.

|parent-transaction-amount
|Response only
|String 
|18.3
|``requested-amount`` of the preceding ``authorization``. +
Not returned for recurring authorizations with <<KlarnaV2_TransactionTypes_authorizationRecurring_Fields_sequenceType, ``sequence-type`` ``first``.>>

|parent-transaction-amount@currency
|Response only
|String 
|3
|``requested-amount@currency`` of the preceding ``authorization``. +
Not returned for recurring authorizations with <<KlarnaV2_TransactionTypes_authorizationRecurring_Fields_sequenceType, ``sequence-type`` ``first``.>>

4+<.>h|``periodic`` h|**For recurring payments.**

|[[KlarnaV2_TransactionTypes_authorizationRecurring_Fields_periodicType]]periodic-type
|M
|String
|24	
a|Periodic type of recurring/periodic payments: +

* ``recurring``
* ``installment``
//-

Both values are processed in the same way.

|[[KlarnaV2_TransactionTypes_authorizationRecurring_Fields_sequenceType]]sequence-type
|M
|String
|10	
a|Specifies the occurence of an authorization in a sequence of recurring/periodic payments: +

* ``first``:
 ** For the initial authorization request.
 ** Endpoint: ``\https://api-test.wirecard.com/engine/rest/paymentmethods/``
* ``recurring``:
 ** For recurring authorization requests that follow the initial recurring payment or any further recurring payments.
 ** Endpoint: ``\https://api-test.wirecard.com/engine/rest/payments/``
* ``final``: 
 ** For the last recurring authorization of a sequence.
 ** Endpoint: ``\https://api-test.wirecard.com/engine/rest/payments/``
//-

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_paymentMethod.adoc[tags=**;!mandatory;!optional;!adjust-authorization;!non-recurring]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_notifications.adoc[]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_accountHolder.adoc[tags=**;!adjustAuthorization]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_accountHolderAddress.adoc[tags=**;!adjustAuthorization]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_shipping.adoc[]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_orderItems.adoc[]

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_status.adoc[]

4+<.>h|``additional-provider-data.provider-data``
h|**Contains max. 1 additional data item for _Klarna_.**

|request
|O
|String
|
|Content should be an object containing any of the keys and sub objects described in https://developers.klarna.com/api#payments-api-create-a-new-credit-session serialised to JSON. +
E.g. +
 ``{"marketplace_seller_info":[{"product_category":"Women''s Fashion","product_name":"Women Sweatshirt"}]}``
|===


[#KlarnaV2_TransactionTypes_authorizationRecurring_Samples]
===== Recurring _authorization_ Samples

.Initial _authorization_ Request for Recurring Payments
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_initial_request.xml[]
----

.Initial _authorization_ Response for Recurring Payments
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_initial_response.xml[]
----

NOTE: To proceed with a successful authorization transaction, take the URL from ``<payment-method url="http://...">`` from the response, replace ``\&amp;`` with ``&`` and redirect your consumer to this URL.

._authorization_ Request for Recurring Payment
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_request.xml[]
----

._authorization_ Response for Recurring Payment
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_response.xml[]
----
.Final _authorization_ Request for Recurring Payments
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_final_request.xml[]
----

.Final _authorization_ Response for Recurring Payments
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_final_response.xml[]
----


[#KlarnaV2_TransactionTypes_authorizationRecurring_autoCapture_Samples]
===== Recurring _authorization_ with auto-capture Samples

.Initial _authorization_ with auto-capture Request for Recurring Payments
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_autoCapture_initial_request.xml[]
----

.Initial _authorization_ with auto-capture Response for Recurring Payments
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_autoCapture_initial_response.xml[]
----

NOTE: To proceed with a successful authorization transaction, take the URL from ``<payment-method url="http://...">`` from the response, replace ``\&amp;`` with ``&`` and redirect your consumer to this URL.

._authorization_ with auto-capture Request for Recurring Payment
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_autoCapture_request.xml[]
----

._authorization_ with auto-capture Response for Recurring Payment
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_autoCapture_response.xml[]
----
.Final _authorization_ with auto-capture Request for Recurring Payments
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_autoCapture_final_request.xml[]
----

.Final _authorization_ with auto-capture Response for Recurring Payments
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_authorization_recurring_autoCapture_final_response.xml[]
----

//-
