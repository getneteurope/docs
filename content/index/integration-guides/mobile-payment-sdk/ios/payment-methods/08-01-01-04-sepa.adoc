[#MobilePaymentSDK_iOS_SEPA]
---
== *SEPA Direct Debit*
---
=== Supported https://docs.getneteurope.com/AppendixB.html[Transaction Types]
---
This payment method supports the following
https://docs.getneteurope.com/AppendixB.html[transaction
types]:

* *`SDKPayECTransactionTypeAuthorization`* - places the account holder’s
funds on hold, pending future capture, re-authorization or void
transaction.
* *`SDKPayECTransactionTypeDebit`* - Moves funds from the [Account Holder] to the [Merchant].
* *`SDKPayECTransactionPendingDebit`* - represents the request for a debit. If the [Transaction State] is success, then the outcome of the debit is not yet known. A further [Transaction Type] of debit follows, whose [Transaction State] indicates the outcome. If the [Transaction State] of the pending-debit is failed, then the request has not been processed.

[#MobilePaymentSDK_iOS_SEPA_basic_setup]
=== Basic Setup
---
[#MobilePaymentSDK_iOS_SEPA_basic_setup_cocoapods]
==== Cocoapods
---
Add to your app’s `Podfile` subspecs:
 
[source,ruby]
----
pod 'Getnet/SEPA',          '~> {{version}}'
----

[#MobilePaymentSDK_iOS_SEPA_basic_payment]
=== SEPA Payment
---
This is a code example for a basic SEPA payment:


[source,swift]
----
// 1. Initialize ``SDKPayECClient``
   do {
      try self.client = SDKPayECClient.init(hostname: hostname)
   } catch {
      // the device is checked during initialization for jailbreak.
      // It is risky to make payments on jailbroken devices.
      return
   }

// 2. Initialize payment object and set mandatory properties
// Parameters (amount, currency, transactionType) shall be sent to server for validation or just provided by server
// and used to generate signature. Signature MUST be generated on server side.
// Signature doc: https://docs.getneteurope.com/_mobile_payment_sdk.html#MobilePaymentSDK_BasicSetup_Security_Signaturev2
// Secret Key shall never be stored in application.

   let payment = SDKPayECSEPAPayment()
   payment.appScheme = "example"
   payment.amount = AMOUNT
   payment.currency = "EUR"
   payment.transactionType = .debit

```
----

//-

[TIP]
====
You can set optional parameters after the payment object is created. Check the documentation <<SEPADirectDebit_Fields, SEPA Direct Debit>> payment method for more details.

SEPA payment supports
`SDKPayECPeriodicTypeRecurring`
recurring type. Check the API documentation <<GeneralPlatformFeatures_Transactions_Recurring, Recurring Transaction>> for more details.
====

//-

[#MobilePaymentSDK_iOS_SEPA_recurring_payment]
=== Recurring SEPA Payment
---
On a basic level, recurring payments have two phases:

[arabic]
. The initial request, which must include:
* periodic type set to `SDKPayECPeriodicTypeRecurring`,
* sequence type set to `SDKPayECSequenceTypeFirst`.
. The follow-up requests, which must include:
* periodic type set to `SDKPayECPeriodicTypeRecurring`,
* sequence type set to `SDKPayECSequenceTypeRecurring`,
* `parentTransactionId`
value from the initial request.

So in order to create a recurring payment, you need to:

[arabic]
. Send a initial request with the appropriate periodic and sequence
flags,
. Save the values of
`parentTransactionId`
field generated in this first payment,
. Reference these values in the follow-up request, then send it with
appropriate periodic and sequence flags.


This is a code example for a first recurring SEPA payment:
[source,swift]
----
// First payment 

   let firstPeriodicType = SDKPayECPeriodic() 
   firstPeriodicType.periodicType = .recurring
   firstPeriodicType.sequenceType = .first

   let payment = SDKPayECSEPAPayment()
   payment.merchantAccountID = merchantAccountID  
   payment.requestID = requestID
   payment.amount = NSDecimalNumber(mantissa: 199, exponent: -2, isNegative: NO)
   payment.currency = "EUR"
   payment.transactionType = .debit
   let periodic = SDKPayECPeriodic()
   periodic.periodicType = periodicType
   periodic.sequenceType = sequenceType
   payment.periodic = firstPeriodicType
   payment.signature = signature
   
   var parentTransactionID: String?
   self.client?.make(payment, withCompletion:{(response: SDKPayECPaymentResponse?,error: Error?) in
      // for each failure error object is provided;
      if let error = error {
         return
      }
      self.handleResponse(response)
   })

   // Handle first result
   func handleReponse(_ response: SDKPayECPaymentResponse?) {
      guard let response = response else { return }
      self.parentTransactionID = response.parentTransactionID
   }

   // Second payment using parentTransactionId

   let firstPeriodicType = SDKPayECPeriodic()
   firstPeriodicType.periodicType = .recurring
   firstPeriodicType.sequenceType = .final
   
   let payment = SDKPayECSEPAPayment()
   payment.merchantAccountID = merchantAccountID  
   payment.requestID = requestID
   payment.parentTransactionID = self.parentTransactionID
   payment.amount = NSDecimalNumber(mantissa: 199, exponent: -2, isNegative: NO)
   payment.currency = "EUR"
   payment.transactionType = .autorization

   let periodic = SDKPayECPeriodic()
   periodic.periodicType = periodicType
   periodic.sequenceType = sequenceType
   payment.periodic = firstPeriodicType
   payment.signature = signature

   self.client?.make(payment, withCompletion:{(response: SDKPayECPaymentResponse?,error: Error?) in
      // for each failure error object is provided;
      if let error = error {
         return
      }
      self.handleResponse(response)
   })
```
----

//-

[#MobilePaymentSDK_iOS_Sepa_Visualisaton]
=== Visualisation
---

[%autowidth, cols="a,a", frame=none, grid=none, role="center"]
|===
| Default | Customized

| image::images/07-01-02-integrating-mpsdk-on-ios/iOS/sepa.png[Sepa Screen, align=center, width=240, height=420]
| image::images/07-01-02-integrating-mpsdk-on-ios/iOS/sepa-customized.png[Sepa Screen, align=center, width=240, height=420]
|
|===

[#MobilePaymentSDK_iOS_Sepa_Visualisaton_CustomizingVisuals]
=== Customizing Visuals
---
To change colors within the SDK, set properties of the components, that
conforms to UIAppearance protocol. Changing any of these will affect
every module used in the SDK.

[arabic]
. `SDKPayECNavigationBar control` - a top navigation bar supports the next appearance:
   .. `preferredStatusBarStyle` - navigation bar style 'SDKPayECNavigationBarStyle' defines the height of the navigation bar top save area of the screen. It can be defined with two possible values:
      - `.small` - a smaller size navigation bar with a title,
      - `.big` - a bigger size navigation bar with possibly a title and a subtitle. The big size of the bar is possible when the next content of the screen is fully readable. If not the navigation bar size is automatically changed to the small size of the navigation bar.
   .. `barStyle` - navigation bar style 'SDKPayECStatusBarStyle' defines the content colors of the navigation bar. It can be defined with three possible values:
      - `.darkContent` - Dark content, for use on light backgrounds, 
      - `.lightContent` - Light content, for use on dark backgrounds, 
      - `.auto` - Custom content, for use on backgrounds by the background color of SDKPayECNavigationBar control
   .. `backgroundColor` - background color
   .. `firstBackgroundColor` - first gradient background color. It is used when the background appearance color is nil. 
   .. `secondBackgroundColor` - second gradient background color. It is used when the background appearance color is nil.
   .. `UIView` appearance

. `SDKPayECCancelButton` - cancel button inside the SDKPayECNavigationBar navigation bar
   .. `UIButton` appearance

. `SDKPayECHeaderLabel` - title label inside the SDKPayECNavigationBar navigation bar
   .. `UILabel` appearance

. `SDKPayECTextField` - 
   .. `UITextField` appearance

. `SDKPayECSubmitButton` - submit button inside the SDKPayECNavigationBar navigation bar
   .. `UIButton` appearance

. `SDKPayECTView` - 
   .. `UIView` appearance

. `SDKPayECTextView` - 
   .. `UITExtView` appearance

. `SDKPayECSwitch` - 
   .. `UISwitchView` appearance

. `SDKPayECAmountLabel` - 
   .. `UILabel` appearance


   
[#MobilePaymentSDK_iOS_Sepa_Visualisaton_CustomizingVisuals_Example]
==== Customization Example
---

This is a code example for a basic Sepa screen customization:

[source,swift]
----
      let blue = UIColor(red: 0.0/255.0, green: 90.0/255.0, blue: 160.0/255.0, alpha: 1.0)
      let yellow = UIColor(red: 251.0/255.0, green: 187.0/255.0, blue: 1.0/255.0, alpha: 1.0)
      let red = UIColor(red: 237.0/255.0, green: 24.0/255.0, blue: 70.0/255.0, alpha: 1.0)
      let orange = UIColor(red: 255.0/255.0, green: 155.0/255.0, blue: 4.0/255.0, alpha: 1.0)
      let firstBgColor = red
      let secondBgColor = yellow

      SDKPayECNavigationBar.appearance().preferredStatusBarStyle = .auto
      SDKPayECNavigationBar.appearance().firstBackgroundColor = firstBgColor
      SDKPayECNavigationBar.appearance().secondBackgroundColor = secondBgColor

      SDKPayECCancelButton.appearance().setTitleColor(yellow, for: .normal)
      SDKPayECCancelButton.appearance().setTitle("Close", for: .normal)
      SDKPayECCancelButton.appearance().backgroundColor = nil

      SDKPayECHeaderLabel.appearance().textColor = UIColor.black

      SDKPayECView.appearance().backgroundColor = yellow

      SDKPayECAmountLabel.appearance().textColor = UIColor.darkGray
      SDKPayECAmountLabel.appearance().text = "Order Amount"

      SDKPayECTextView.appearance().textColor = UIColor.white
      
      SDKPayECSwitch.appearance().tintColor = UIColor.white
----

[%autowidth, cols="a,a", frame=none, grid=none, role="center"]
|===
| Default | Customized

| image::images/07-01-02-integrating-mpsdk-on-ios/iOS/sepa-appearance.png[Sepa Screen Appearance, align=center, width=240, height=420]
| image::images/07-01-02-integrating-mpsdk-on-ios/iOS/sepa-customized-appearance.png[Sepa Screen Appearance, align=center, width=240, height=420]
|
|===
   
//-